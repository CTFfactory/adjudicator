#!/bin/bash

BOLD_BLACK="\e[1;30m"
BOLD_WHITE="\e[1;37m"
BOLD_YELLOW="\e[1;33m"
BOLD_GREEN="\e[1;32m"
BOLD_RED="\e[1;31m"
BACKGROUND_WHITE='\e[47m'
BACKGROUND_BLACK='\e[100m'
BACKGROUND_GREEN='\e[102m'

NC='\e[0m'

function print_good () {
    echo -e "${BACKGROUND_BLACK}${BOLD_GREEN}[$(date +%F)]\t${BOLD_GREEN}[+]${NC} # ${BOLD_BLACK}${BACKGROUND_WHITE} ${1} ${NC} #"
}

function print_error () {
    echo -e "${BACKGROUND_BLACK}${BOLD_RED}[$(date +%F)]\t${BOLD_RED}[!!]${NC} # ${BOLD_BLACK}${BACKGROUND_WHITE} ${1} ${NC} #"
}

function print_info () {
    echo -e "${BACKGROUND_BLACK}${BOLD_WHITE}[$(date +%F)]\t[?]${NC} # ${BOLD_BLACK}${BACKGROUND_WHITE} ${1} ${NC} #"
}

function print_warning () {
    echo -e "${BACKGROUND_BLACK}${BOLD_YELLOW}[$(date +%F)]\t${BOLD_YELLOW}[!]${NC} # ${BOLD_BLACK}${BACKGROUND_WHITE} ${1} ${NC} #"
}

echo '''

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##****#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*:........................-#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%+....................................#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%+.........:*%%%%%%%%%%%%%%%%%%%%%%+..........#%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%-.......-%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#........*%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%*.......%%%%%%%%%%:.#%.%%+%.%%.%%:%%.+%=%%%%%%%%%#.......%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%......:%%%%%%%%%%%%:#+%%.%%:%.%%%%%#%%.%%.-%-+%%%%%%%%%......+%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%......%%%%%%%%-%#%%%%##%:%.:+#%%%%%%%#.:%%.%+#+%#+%.%%%%%%%+.....-%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%......%%%%%%.=*%%%%%=%%%%%%%%%%%%%%%%%%%%%%%%%%:%#=%%*#%.=%%%%%%.....+%%%%%%%%%%%%%%
%%%%%%%%%%%%%%=.....%%%%%#%*+.%.%.=%%%%%%%%%%%%%%%.**%%*-.:%%%%%%%%*+%#=%%%.%%%%%%.....%%%%%%%%%%%%%
%%%%%%%%%%%%%.....%%%%%%#=*%%::#%%%%%%%%%%%%%+..%-..**.+:%#+#*++=-*%%%%=%=#%%.%%%%%*....:%%%%%%%%%%%
%%%%%%%%%%%+....*%%%%#=.=...%%%%%%%%%%%%#.:+.--.#..-.-+-+#-..%%%#:=.%%%%%%#:%.%%#%%%%.....%%%%%%%%%%
%%%%%%%%%%:....%%%%#:.#%:+%%%%%%%%%%#..*%%*:+=.--+*+%%#**+%-=#-:-:--%%%%%%%#%%%.%%%%%%#....*%%%%%%%%
%%%%%%%%%....:%%%%*%%%%=%%%%%%%%%+--*:=%+%=-::..#+%*%.*-#+=.=...%=#%%%%%%%%%%-#%%%%%%%%%....=%%%%%%%
%%%%%%%%....=%%%%#%.%%:%%%%%%%%::.#%*-#+-.*=%=%*=.::-:-+...-.:..#.+.*%%%%%%%%%%%%%+-.%%%%....-%%%%%%
%%%%%%%....=%%%%%#.#%%%%%%%%#.::+:*##.:#%.*.-=-=-:%%-.:%.+...:---.==-::%%%%%%%%%-%%:#.%%%%....=%%%%%
%%%%%%:...-%%%%*+%%#%%%%%%#:%.%.%*-:+#%.:*%%%%%%%%%%%%%%:+.*#+.#-+:..##+.%%%%%%%%%%%%%.%%%%....#%%%%
%%%%%*....%%%#*#.*+%%%%%%.*#-%=*%:-%#:%%%%%*..............*=..+%%#.-*:.#-:*%%%%%%%#.+%%#%%%%....%%%%
%%%%%....%%%%%%%%%%%%%%=:*+:.+#*.%.#%%%%:..=%%%%%%%%%%%%%%+...%%%%%*.##.::..%%%%%%%#=.=%.%%%*....%%%
%%%%:...*%%%.+#%+%%%%%..#-+-*==+#*%%%#..*%%%%%%%%%%%%%%%%%%%%#..*%%%%:+-=-#*:%%%%%%%=%%%:%%%%....#%%
%%%%....%%%%.%%%.%%%%.%*=#%*%-#.%%%%..%%%%%%%%%%%%..%%%%%%%%%%%%..#%%%#*-+-#=-#%%%%%%%%%%#%%%%....%%
%%%=...+%%%%%%#%%%%%-:%#+%:=+%.%%%-.+%%%%%%%%%%%%:..:%%%%%%%%%%%%#.:%%%%:##.=-#%%%%%%%.*:%.%%%....%%
%%%....%%%#...=-%%%%.#%-.#%++-%%%..%%%%%%%%+...%+....+%...+%%%%%%%%..%%%#..*=#+*%%%%%%.%%+:%%%*...=%
%%%....%%%-=-.%%%%%.+:*+-%+.*%%%-.%%%%%%%..#%.+#..%%..#=:%#..%%%%%%%..%%%:+%=+=*.%%%%%%%%%%+%%%....%
%%#...-%%%%%%%.%%%%..%+#*=+-*%%%.+%%%%%%.:%%-.%..#%%#..%.=%%:.%%%%%%#.*%%%:%:-+%*#%%%%%*%%%%%%%....%
%%+...*%%%%%%%%%%%*+.%=%%.-*%%%..%%%%%%..%%%.-..=%%%%=..:.%%%..%%%%%%..%%%.+.---#.%%%%%%%%%%%%%....%
%%+...#%%%:...%%%%--%:.#:#-:%%%.-%%%%%-.#%%%..............%%%#.=%%%%%+.%%%-+%:+%:.%%%%%%...-%%%....%
%%+...*%%%#..:%%%%+=*%.:%*:=%%%.+%%%%%:.#%%%...#%%%%%%#...%%%#.:%%%%%#.%%%**##-%*:%%%%%%:..%%%%....%
%%*...=%%%%%%%%%%%+**%.+.%-+%%%.=%%%%%+.:%%%..+%%%%%%%%+..%%%:.*%%%%%*.%%%-=*-:-+.%%%%%%%%%%%%%....%
%%%....%%%%%%:%%%%#=*=*.%#.-%%%..%%%%%%..%%#...-%%%%%%-...#%%..%%%%%%:.%%%.=%=-.*.%%%%%%-.%*%%%....%
%%%....%%%-%%*%%%%%:*+%:+%.*%%%+.%%%%%%%..%..%%..%%%%..%%..%..%%%%%%%.-%%%..%..%..%%%%%%%%*%%%#...:%
%%%:...#%%%:.%*%%%%--*:%.*-=.%%%..%%%%%%%:...%%%%.::.%%%%...:%%%%%%%..%%%+=%%--%.:%%%%%%=+%#%%-...#%
%%%#...:%%%-##=%%%%%.:-%-.:#--%%%.:%%%%%%%%%%%%%%=..+%%%%%%%%%%%%%%-.%%%%:%+%.*:.%%%%%%#%%-%%%....%%
%%%%....%%%:-%%#%%%%*.:=%:.%.-*%%%..%%%%%%%%%%%*:%%%%:*%%%%%%%%%%%..%%%%.*%=-**.-%%%%%=*..%%%=...+%%
%%%%#....%%%..%#%%%%%:==%:%.=**+%%%:.*%%%%%%%*%%%%%%%%%%*%%%%%%%#..%%%+.*.#-##:.%%%%%*-%%%%%%....%%%
%%%%%:...+%%%%::%%%%%%.*::.-*.*-:%%%%..#%%%%%%%%%%%%%%%%%%%%%%#..#%%%*-+%%==%-.%%%%%%-=%#%%%....#%%%
%%%%%%....#%%=++%.%%%%%.::+%%:...:*%%%%...#%%%%%%%%%%%%%%%%%...%%%#.+.+:%.:%-.%%%%%%=#..*%%-...:%%%%
%%%%%%%....%%%*=#%*%%%%%-.*-+*+%::+.=%%%%%:...-#%%%%%%#=....#%%%#=+*--#+:+.-.%%%%%%%%:%%%%+....%%%%%
%%%%%%%#....%%%#+.%*%%%%%%:.=%=+*=-:.*-+%%%%%%%+-:...:+#%%%%%%::%*+*-.=.#-..%%%%%#%%%*%%%+....%%%%%%
%%%%%%%%#....#%%%=**:-%%%%%=.=.**%+%%:%=.-.:*%%%%%%%%%%%%#*.%%%%:*.%%.---.#%%%%%:%.#+#%%=....%%%%%%%
%%%%%%%%%%....+%%%%%=*-%%%%%%=.:%.::-+-++=+=+=:--.-..:+%++#*%#:=+=*=-=-.-%%%%%#:-%.-%%%.....%%%%%%%%
%%%%%%%%%%%.....%%%=%%%.#%%%%%%%.-.%-%%.%%+%%%*#%%-%%%%++%#.-:#:=.....#%%%%%%:=%%.%%%%....:%%%%%%%%%
%%%%%%%%%%%%:....*%%%.%-:..%%%%%%%%+.-+.:#*-+%%#.%+%.-+:.:=.=+..:.:%%%%%%%%%%.%#:%%%:....#%%%%%%%%%%
%%%%%%%%%%%%%%.....%%%%-:%*#*+%%%%%%%%%%-..........-::=+-.=...=%%%%%%%%%=.%:%%=%%%*.....%%%%%%%%%%%%
%%%%%%%%%%%%%%%=.....%%%%:%%%%.%%%%%%%%%%%%%%%%%#+=--=+#%%%%%%%%%%%%%*=%%%.%%%%%#.....%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%:.....%%%%##:%*-%:.%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%-%%*%.#%%%=.....*%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%:.....-%%%%%.%%%+#%%%*=%%%%%%%%%%%%%%%%%%*#%%%##=%=.%%%%%......#%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%*......=%%%%%=#%%%:%%##.%-%%:*:-#-%%##*:%%%%=%#%%%%%.......%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%:.......#%%%%%%%.:+%#%%%%%%-%%.%%-%:=.#%%%%%%+.......+%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%:........-%%%%%%%%%%%%%%%%%%%%%%%%%%%#:........+%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#............:+##%%%%%%%%#*=............:%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%=.............................:#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*-:............:=#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

'''

USERNAME="adjudicator"

print_info "Checking if curl is installed"

if [[ -z "$(which curl)" ]];
then
    print_warning "Curl is not installed."
    sudo apt-get install curl -y
fi

print_info "Checking if docker is already installed and setup"

if [[ -z "$(which docker)" ]];
then
    print_warning "Docker is not setup"
    sudo groupadd docker
    sudo usermod -aG docker ubuntu
    curl -fsSL https://get.docker.com -o get-docker.sh
    chmod +x get-docker.sh
    ./get-docker.sh
fi

print_info "Building docker image"
DOCKER_BUILDKIT=1 docker build --no-cache -t adjudicator-local:latest --build-arg user=${USERNAME} --build-arg uid=1000 --build-arg gid=1000 -f ./Dockerfile .
print_good "Docker image was built; container should be running..."
docker ps adjudicator-local:latest